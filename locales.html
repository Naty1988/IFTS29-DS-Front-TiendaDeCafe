<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Encuentra Tiendas de Café</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@200..700&display=swap" rel="stylesheet">

    <style>
        /* Estilos básicos */
        #map {
            height: 500px; /* Altura del mapa */
            width: 70%; /* Ancho del mapa */
            float: right; /* Mapa a la derecha */
        }
        #results {
            width: 30%; /* Ancho del listado de resultados */
            float: left; /* Listado a la izquierda */
            max-height: 500px; /* Altura máxima */
            overflow-y: auto; /* Scroll vertical si es necesario */
        }
        .card {
            border: 1px solid #ccc;
            margin: 10px;
            padding: 10px;
        }
    </style>

</head>
<body>
    <head>
        <nav class="navbar">
            <a class="navbar__a" href="./index.html">
                <figure>
                    <img src="./img/TIENDADECAFE.svg" alt="">
                </figure>
            </a>
            <ul class="navbar_ul">
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="./nuestrocafe.html">NUESTRO CAFÉ</a></li>
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="./tutoriales.html">TUTORIALES</a></li>
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="./locales.html">LOCALES</a></li>
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="#">NUESTRO MENÚ</a></li>
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="./trabajaentdc.html">TRABAJÁ CON NOSOTROS</a></li>
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="./franquicias.html">FRANQUICIAS</a></li>
                <li class="navbar_ul_li"><a class="navbar_ul_li__a" href="./contacto.html">CONTACTO</a></li>
            </ul>
        </nav>
    </head>

    <section class="locations-container" style="width: 100vw;">
        <h1>Buscar Tiendas de Café</h1>
        <input type="text" id="address" placeholder="Ingresa tu dirección">
        <button id="search-btn">Buscar</button>
    
        <div id="results"></div>
        <div id="map"></div>
        <button id="auto-fill-btn">Usar mi ubicación</button>    
    </section>

    <footer">
        <div class="footer-container">
            <h2 style="color: black;">TIENDA DE CAFE</h2>
            <ul class="footer-ul">
                <h3>CONTENIDOS</h3>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./index.html">Inicio</a></li>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./nuestrocafe.html">Nuestro Café</a></li>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./locales.html">Locales</a></li>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="#">Nuestro menú</a></li>
            </ul>
            <ul class="footer-ul">
                <h3>CONTENIDOS</h3>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./tutoriales.html">Tutoriales</a></li>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./trabajaentdc.html">Trabajá en TDC</a></li>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./franquicias.html">Franquicias</a></li>
                <li class="footer-ul-li"><a class="footer-ul-li__a" href="./contacto.html">Contacto</a></li>
            </ul>
            <div class="suscribe-container">
                <h3>SUSCRIBITE A NUESTRO NEWSLETTER</h3>
                <form class="form-footer" action="/">
                    <input type="email" placeholder="Tu email">
                    <button>SUSCRIBIRME</button>
                </form>
                <h3>CONECTATE CON NOSOTROS</h3>
                <div class="social-icons-container">
                    <a class="social-icon" href="#"><img src="./img/facebook-icon.svg" alt="ícono de facebook"></a>
                    <a class="social-icon" href="#"><img src="./img/instagram-icon.svg" alt="ícono de instagram"></a>    
                </div>
            </div>
        </div>
        <div class="footer-p-container">
            <p>© Copyright 2021 Tienda de café - Todos los derechos reservados.</p>
            <p>Todos los logos, productos, marcas y nombres aqui utilizados son propiedad registrada.</p>    
        </div>
    </footer>

        <!-- Script de Google Maps con callback a initMap -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxzCRucR-brugXTGnV5RsOJHM-92XnwMk&libraries=places&callback=initMap" async defer></script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCxzCRucR-brugXTGnV5RsOJHM-92XnwMk&libraries=places,geometry&callback=initMap" async defer></script>
    
        <script>
            let map;
            let service;
            let infowindow;
    
            function initMap() {
                // Inicializa el mapa en Buenos Aires
                const initialLocation = { lat: -34.6037, lng: -58.3816 }; // Coordenadas de Buenos Aires
                map = new google.maps.Map(document.getElementById("map"), {
                    center: initialLocation,
                    zoom: 12,
                });
    
                // Se añade el evento de búsqueda aquí
                document.getElementById("search-btn").addEventListener("click", () => {
                    const address = document.getElementById("address").value;
                    const geocoder = new google.maps.Geocoder();
    
                    // Convierte la dirección en coordenadas
                    geocoder.geocode({ address }, (results, status) => {
                        if (status === "OK" && results.length > 0) {
                            const userLocation = results[0].geometry.location;
                            map.setCenter(userLocation);
    
                            // Añade un marcador en la ubicación buscada
                            new google.maps.Marker({
                                position: userLocation,
                                map: map,
                                title: "Ubicación buscada",
                            });
    
                            // Busca los locales cercanos
                            searchNearbyCafes(userLocation);
                        } else {
                            alert("No se pudo encontrar la dirección: " + status);
                        }
                    });
                });
            }
    
            function searchNearbyCafes(location) {
                const request = {
                    location: location,
                    radius: '2000', // 2km de radio
                    type: ['cafe'], // Busca solo cafés
                    keyword: 'Tienda de Café' // Filtra por "Tienda de Café"
                };
    
                service = new google.maps.places.PlacesService(map);
                service.nearbySearch(request, (results, status) => {
                    if (status === google.maps.places.PlacesServiceStatus.OK) {
                        displayResults(results, location); // Pasa la ubicación del usuario
                    } else {
                        alert("No se encontraron resultados: " + status);
                    }
                });
            }
    
            function displayResults(results) {
        const resultsContainer = document.getElementById("results");
        resultsContainer.innerHTML = ''; // Limpia resultados anteriores
    
        // Filtrar resultados para mostrar solo "Tienda de Café"
        const filteredResults = results.filter(place => place.name.toLowerCase() === "tienda de café");
    
        // Verificar si hay resultados filtrados
        if (filteredResults.length === 0) {
            alert("No hay locales cercanos a esa dirección."); // Mensaje de alerta si no hay resultados
            return; // Salir de la función si no hay resultados
        }
    
        filteredResults.forEach((place) => {
            const card = document.createElement("div");
            card.classList.add("card");
            card.innerHTML = `<h3>${place.name}</h3><p>${place.vicinity}</p>`;
            resultsContainer.appendChild(card);
    
            // Muestra cada lugar en el mapa
            const marker = new google.maps.Marker({
                position: place.geometry.location,
                map: map,
                title: place.name,
            });
            
            // Añade un listener para abrir el infowindow
            const infowindow = new google.maps.InfoWindow();
            google.maps.event.addListener(marker, 'click', function() {
                infowindow.setContent(place.name);
                infowindow.open(map, marker);
            });
        });
    }
    
    // Función para obtener la ubicación actual del usuario
    document.getElementById('auto-fill-btn').addEventListener('click', function() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(successCallback, errorCallback);
        } else {
          alert('La geolocalización no es soportada por tu navegador.');
        }
      });
    
      // Si obtenemos la ubicación con éxito
      function successCallback(position) {
        const lat = position.coords.latitude;
        const lon = position.coords.longitude;
    
        // Llamada a la API de Google Maps para convertir las coordenadas en una dirección
        const apiKey = 'AIzaSyCxzCRucR-brugXTGnV5RsOJHM-92XnwMk'; // Asegurate de colocar tu clave de Google Maps
        const url = `https://maps.googleapis.com/maps/api/geocode/json?latlng=${lat},${lon}&key=${apiKey}`;
    
        fetch(url)
          .then(response => response.json())
          .then(data => {
            if (data.status === 'OK') {
              const address = data.results[0].formatted_address;
              document.getElementById('address').value = address;
            } else {
              alert('No se pudo obtener la dirección.');
            }
          })
          .catch(error => console.error('Error:', error));
      }
    
      // Si hay un error al obtener la ubicación
      function errorCallback(error) {
        console.error('Error al obtener la ubicación: ', error);
        alert('Error al obtener tu ubicación.');
      }
    
    
        </script>
    
</body>
</html>